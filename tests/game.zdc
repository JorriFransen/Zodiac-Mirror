
c :: import c;
glfw :: import glfw;
glfw_keys :: import glfw_keys;
gl :: import gl;

main :: () -> int
{
    if (!glfw.glfwInit())
    {
        c.printf("glfwInit failed\n");
        return 9;
    }

    width := 640;
    height := 480;

    glfw.glfwWindowHint(glfw.GLFW_RESIZABLE, glfw.GLFW_FALSE);
    window : *glfw.GLFWwindow = glfw.glfwCreateWindow(width, height, "Triangles!!!", null, null);
    if (!window)
    {
        c.printf("glfwCreateWindow failed\n");
        return 9;
    }

    glfw.glfwSetKeyCallback(window, key_callback);
    glfw.glfwSetErrorCallback(error_callback);

    glfw.glfwMakeContextCurrent(window);
    glfw.glfwSwapInterval(1);
    gl.load(*glfw.glfwGetProcAddress);
    gl.glViewport(0, 0, width, height);

    vendor := gl.glGetString(gl.GL_VENDOR);
    renderer := gl.glGetString(gl.GL_RENDERER);
    version := gl.glGetString(gl.GL_VERSION);

    c.printf("GL vendor: %s\n", vendor);
    c.printf("GL renderer: %s\n", renderer);
    c.printf("GL version: %s\n", version);

    gl.glViewport(0, 0, width, height);

    // glClearColor(0.1, 0.3, 0.5, 1.0);
    gl.glClearColor(0.0, 0.0, 0.0, 0.0);


    while (!glfw.glfwWindowShouldClose(window))
    {
        gl.glClear(gl.GL_COLOR_BUFFER_BIT);

        gl.glBegin(gl.GL_TRIANGLES);
        gl.glColor4f(1.0, 0.0, 0.0, 1.0);
        gl.glVertex2f(-0.5, -0.5);
        gl.glColor4f(0.0, 1.0, 0.0, 1.0);
        gl.glVertex2f(0.5, -0.5);
        gl.glColor4f(0.0, 0.0, 1.0, 1.0);
        gl.glVertex2f(0.0, 0.5);
        gl.glEnd();

        glfw.glfwSwapBuffers(window);
        glfw.glfwPollEvents();
    }

    glfw.glfwDestroyWindow(window);
    glfw.glfwTerminate();
}

key_callback :: (window: *glfw.GLFWwindow, key: int, scancode: int, action: int, mods: int) -> void
{
    if (key == glfw_keys.GLFW_KEY_ESCAPE && action == glfw.GLFW_PRESS)
    {
        c.printf("Exit requested by user\n");
        glfw.glfwSetWindowShouldClose(window, glfw.GLFW_TRUE);
    }
    // switch (action)
    // {
    //     case glfw.GLFW_RELEASE:
    //         c.printf("released key: %lu\n", key);

    //     case glfw.GLFW_PRESS:
    //         c.printf("pressed key: %lu\n", key);

    //     case glfw.GLFW_REPEAT:
    //         c.printf("repeat key: %lu\n", key);

    //     default:
    //         c.printf("Unknown action: %lu, key: %lu\n", action, key);
    // }
}

error_callback :: (error: int, description: *u8) -> void
{
    c.fprintf(c.stderr, "GLFW error:%lu:s\n", error, description);
}
