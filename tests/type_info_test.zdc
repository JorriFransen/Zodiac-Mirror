
std :: import std;
using std;

main :: ()
{
    print("Type info test");

    int_info : *Type_Info = get_type_info(int);
    print_type_info("int", int_info);
    print_type_info("u64", get_type_info(u64));
    print_type_info("*int", get_type_info(*int));
    print_type_info("*u64", get_type_info(*u64));
    print_type_info("u8", get_type_info(u8));

    print_type_info("String", get_type_info(String));
}

print_type_info :: (name: *u8, info: *Type_Info)
{
    _c.printf("%s: ", name);
    print_type_info(info);
    _c.printf("\n");
}

print_type_info :: (info: *Type_Info)
{
    assert(info);
    switch (info.kind)
    {
        case (:Type_Info_Kind)Type_Info_Kind.BASE:
        {
            _c.printf("%.*s ", info.name.length, info.name.data);
        }

        case (:Type_Info_Kind)Type_Info_Kind.POINTER:
        {
            _c.printf("*");
            base := (:*Type_Info)info.base;
            print_type_info(base);
        }

        case (:Type_Info_Kind)Type_Info_Kind.STRUCT:
        {
            _c.printf("%.*s :: struct { ", info.name.length, info.name.data);
            first_member := info.aggregate.first;

            for (i : u64 = 0; i < info.aggregate.count; i++)
            {
                member := first_member[i];
                _c.printf("%.*s: ", member.name.length, member.name.data);

                mti := (:*Type_Info)member.type;
                print_type_info(mti);

                if (i < info.aggregate.count - 1)
                {
                    _c.printf(", ");
                }

            }

            _c.printf("} ");
        }

        case (:Type_Info_Kind)Type_Info_Kind.INVALID:
        {
            assert(false);
        }

        default: assert(false);
    }
}
